<% layout(config.site.theme+'/page.ejs') -%>

<%

    var name = product.name.split(' ')
    var end_name = name.pop()
    name = name.join(' ')

 %>

<section class="page bg-cream-1 product single">

    <div class="contain">

        <div class="layout">

            <div class="gallery">
                <img src="<%- product.thumbnail %>" app-src="view.gallery_image" class="main-image" alt="This is the product image for <%- product.name %>">

                <% if (Array.isArray(product.gallery) && product.gallery.length > 0){ %>
                    <div class="thumbs">
                        <% product.gallery.forEach((image)=>{ %>
                            <img src="<%- image.value %>" class="clickable" app-click="selectImage('<%- image.value %>')">
                        <% }) %>
                    </div>
                <% } %>

            </div>

            <div class="details">

                <div class="breadcrumbs">
                    <a href="/<%- view.ecommerce.shop.slug %>" title="View all products">Categories</a> /
                    <a class="" href="/<%- category.slug %>" title="View products in the <%- category.name %> category"><%- category.name %></a>
                    <% if (typeof sub_category == 'object'){ %>
                        / <a class="" href="/<%- category.slug %>/<%- sub_category.slug %>" title="View products in the <%- sub_category.name %> category"><%- sub_category.name %></a>
                    <% } %>
                </div>

                <div class="info">
                    <h1 class="slab title" title="This product is called <%- product.name %>"><span><%- name.trim() %></span><span class="ml-05 text-weight-200"><%- end_name.trim() %></span></h1>
                    <h2 class="price" title="The price for <%- product.name %> is £<%- functions.getPrice(product) %>">
                        £<%- functions.getPrice(product) %>
                        <% if (product.adjustment){ %>
                            <br>
                            <span class="previous-price"><%- view.functions.parseCurrency(product.original_price) %></span>
                            <% if (typeof product.adjustment == 'string' && product.adjustment.match(/%/)){ %>
                                <span class="discount-price"><%- Math.abs(product.adjustment.replace(/%/g,'')) %>% off</span>
                            <% } else { %>
                                <span class="discount-price">£<%- Math.abs(product.adjustment).toFixed(2) %> off!</span>
                            <% } %>
                        <% } %>
                    </h2>

                    <% if (product.description){ %>
                        <p><%- product.description %></p>
                        <p>Give us a call on 01706 822828 or email us at info@chocolate-café.co.uk if you have a question about this product.</p>
                        <p>Delivery information can be found <a href="/delivery-information">here</a></p>
                    <% } %>

                    <div class="actions">
                        <div class="quantity">
                            <button class="remove" app-click="quantity('minus')" title="Reduce quantity"><i class="fas fa-minus"></i></button>
                            <input type="text" class="number" app-model="view.add_item.quantity" title="Add this amout to your basket">
                            <button class="add" app-click="quantity('add')" title="Increase quantity"><i class="fas fa-plus"></i></button>
                        </div>
                        <% if (product.stock){ %>
                            <button class="buy" title="Add <%- product.name %> to your basket" app-click="addToCart('<%- product._key %>','<%- product.guard %>')">Oh go on then</button>
                        <% } else { %>
                            <button class="out-of-stock" title="<%- product.name %> are out of stock">Out of stock</button>
                        <% } %>
                    </div>

                </div>

                <div class="sharing">
                    <span class="mr-05">Share this</span>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=<%- view.functions.parseURL(product.url) %>" target="_blank" title="Share <%- product.name %> on Facebook"><img src="/images/sharing/Icon-Facebook.svg" class="icon lg mr-05"></a>
                    <a href="https://twitter.com/share?text=<%- view.functions.parseURL(product.name) %>&url=<%- view.functions.parseURL(product.url) %>" target="_blank" title="Share <%- product.name %> on Twitter"><img src="/images/sharing/Icon-Twitter.svg" class="icon lg"></a>

                </div>

            </div>

        </div>

    </div>

    <div class="content">

        <div class="contain">

            <div class="tabs" app-init="view.tab = 'content'">
                <a app-click="view.tab = 'content'" app-class="{'active':view.tab == 'content'}">Information</a>
                <a app-click="view.tab = 'nutrition'" app-class="{'active':view.tab == 'nutrition'}">Nutrition</a>
                <a app-click="view.tab = 'reviews'" app-class="{'active':view.tab == 'reviews'}">Reviews</a>
            </div>

            <% if (!product.content_before_details && product.content){ %>
                <div class="content-text" app-show="view.tab == 'content'">
                    <%- product.content %>
                </div>
            <% } %>

        </div>

    </div>

    <div class="related">

        <div class="contain">

            <h4 class="slab">Related Products</h4>

            <div class="products">
                <% if (typeof related == 'object' && related.length > 0){ %>

                    <% related.forEach((product,i)=>{ %>

                        <%- include('partials/product_thumb.ejs',{product: product}) %>

                    <% }) %>

                <% } %>
            </div>

        </div>

    </div>

</section>
