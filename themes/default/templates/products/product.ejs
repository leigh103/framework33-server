<% layout(config.site.theme+'/page.ejs') -%>

<section class="page bg-cream-1 product single">

    <div class="contain">

        <div class="layout">

            <div class="gallery">
                <img src="<%- product.image %>" app-src="view.gallery_image" class="main-image">
                <div class="thumbs">
                    <% if (Array.isArray(product.gallery) && product.gallery.length > 0){ %>
                        <img src="<%- product.image %>" class="clickable" app-click="view.gallery_image = '<%- product.image %>'">
                        <% product.gallery.forEach((image)=>{ %>
                            <img src="<%- image.value %>" class="clickable" app-click="view.gallery_image = '<%- image.value %>'">
                        <% }) %>
                    <% } %>
                </div>
            </div>

            <div class="details">

                <div class="breadcrumbs">
                    <a href="/<%- view.ecommerce.shop.slug %>">Products</a> /
                    <a class="" href="/<%- category.slug %>"><%- category.name %></a>
                    <% if (typeof sub_category == 'object'){ %>
                        / <a class="" href="/<%- category.slug %>/<%- sub_category.slug %>"><%- sub_category.name %></a>
                    <% } %>
                </div>

                <div class="info">
                    <h1 class="slab title"><%- product.name %></h1>
                    <h2 class="price">
                        £<%- functions.getPrice(product.price, product.adjustment) %>
                        <% if (product.adjustment){ %>
                            <br>
                            <span class="previous-price"><%- view.functions.parseCurrency(product.price) %></span>
                            <% if (typeof product.adjustment == 'string' && product.adjustment.match(/%/)){ %>
                                <span class="discount"><%- Math.abs(product.adjustment.replace(/%/g,'')) %>% off</span>
                            <% } else { %>
                                <span class="discount">£<%- Math.abs(product.adjustment/100).toFixed(2) %> off!</span>
                            <% } %>
                        <% } %>
                    </h2>

                    <% if (product.description){ %>
                        <p><%- product.description %></p>
                        <p>Give us a call on 01706 822828 or email us at info@chocolate-café.co.uk if you have a question about this product.</p>
                        <p>Delivery information can be found <a href="/delivery">here</a></p>
                    <% } %>

                    <div class="actions">
                        <div class="quantity">
                            <button class="remove" app-click="quantity('minus')"><i class="fas fa-minus"></i></button>
                            <input type="text" class="number" app-model="view.add_item.quantity">
                            <button class="add" app-click="quantity('add')"><i class="fas fa-plus"></i></button>
                        </div>
                        <% if (product.stock){ %>
                            <button class="buy" app-click="addToCart('<%- product._key %>','<%- product.guard %>')">Oh go on then</button>
                        <% } else { %>
                            <button class="out-of-stock">Out of stock</button>
                        <% } %>
                    </div>

                </div>

                <div class="sharing">
                    <a href="https://www.facebook.com/sharer/sharer.php?u=<%- view.functions.parseURL(product.url) %>" class="facebook" target="_blank"><img src="/images/sharing/sm-Facebook.svg" class="icon xl mr-05"></a>
                    <a href="https://twitter.com/share?text=<%- view.functions.parseURL(product.name) %>&url=<%- view.functions.parseURL(product.url) %>" class="twitter" target="_blank"><img src="/images/sharing/sm-Twitter.svg" class="icon xl"></a>

                </div>

            </div>

        </div>

    </div>

    <div class="content">

        <div class="contain">

            <div class="tabs" app-init="view.tab = 'content'">
                <a app-click="view.tab = 'content'" app-class="{'active':view.tab == 'content'}">Description</a>
                <a app-click="view.tab = 'nutrition'" app-class="{'active':view.tab == 'nutrition'}">Details</a>
                <a app-click="view.tab = 'reviews'" app-class="{'active':view.tab == 'reviews'}">Reviews</a>
            </div>

            <% if (!product.content_before_details && product.content){ %>
                <div class="content-text" app-show="view.tab == 'content'">
                    <%- product.content %>
                </div>
            <% } %>

        </div>

    </div>

    <div class="related contain">

        <div class="grid col-4 col-s-2 gap-2 mt-2">
            <% if (typeof related == 'object' && related.length > 0){ %>

                <% related.forEach((product,i)=>{ %>

                    <%- include('partials/product_thumb.ejs',{product: product}) %>

                <% }) %>

            <% } %>
        </div>
        
    </div>

</section>
