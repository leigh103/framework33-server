
<script src="/js/ckeditor/ckeditor.js?v=1.0.3"></script>

<script>

    var contented



    ClassicEditor
        .create( document.querySelector( '#editor' ), {
        toolbar: [ 'heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'blockQuote', '|','indent','outdent', '|','imageUpload','imageTextAlternative', '|','insertTable','tablerow'  ],
        image: {
            toolbar: [ 'imageTextAlternative' ]
        }
    })
        .then( editor => {
            contented = editor
            console.log(Array.from( editor.ui.componentFactory.names() ))
        } )
        .catch( error => {
            console.error( error );
        } );

</script>

<script>

    extend.products = function(){

        scope.view.upload_text = "Upload Image"


        watch['new'] = function(data){
            if (data.category >= 0){
                scope.get('product_categories/'+data.category).then((category)=>{
                    scope.sub_categories = category.sub_categories
                })
            }

        }

        watch['new.category'] = function(data){
            scope.get('product_categories/'+data).then((category)=>{
                scope.sub_categories = category.sub_categories
            })
        }

        scope.editProduct = function(collection, obj, no_modal){

            contextCloseAll()

            scope.resetNew().then(()=>{
            //    console.log(collection, obj)

                if (typeof obj == 'string'){
                    scope.new._key = obj
                } else {
                    scope.new = JSON.parse(JSON.stringify(obj))
                }

                if (scope.new.content){
                    contented.setData( scope.new.content )
                } else {
                    contented.setData( '' )
                }

                if (!no_modal){
                    scope.view.modal = 'show_product_edit'
                }

            })

        }

        scope.upload = function(image, obj, input){

            let payload = {
                base64: image,
                file_name: "test-image-upload",
                file_path: "products"
            }

            scope.view.upload_text = 'Uploading...'

            http('post','/api/image/save',payload).then((data) => {
                if (obj){
                    scope.push(obj,data, input)
                }
                scope.view.upload_text = 'Upload Image'
            }).catch((err)=>{
                scope.notify(err,'error')
            })

        }

    }

</script>
