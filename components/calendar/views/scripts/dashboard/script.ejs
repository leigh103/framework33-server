<script>

    extend.calendar = function(){

        scope.getAppointments = function(date){

            scope.view.calendar = {
                start: moment(date).set({hours:0,minutes:0,seconds:0}),
                end: moment(date).set({hours:23,minutes:59,seconds:59})
            }

            scope.post('appointments/find-by-date',{date:date}).then((appointments)=>{

                scope.appointments = appointments
                view.update('appointments')

                setTimeout(function(){
                    scope.positionAppointments()
                },400)
            })

        }

        scope.positionAppointments = function(){

            let appointments = document.getElementsByClassName('appointment')
            for (var i=0; i<appointments.length;i++){

                if (!appointments[i] || !appointments[i]._app){
                    continue
                }

                let app_data = appointments[i]._app,
                    idx = app_data.index,
                    x_axis = scope.appointments[idx].provider,
                    y_axis = scope.getYAxis(scope.appointments[idx].start_date,scope.appointments[idx].end_date)
                    start_div = x_axis+'-'+y_axis.start,
                    end_div = x_axis+'-'+y_axis.end

                console.log(start_div, end_div)
            }

        }

        scope.getYAxis = function(start_date, end_date){

            start_date = moment(start_date)
            end_date = moment(end_date)

            let result = {
                start: start_date.format('HH-mm'),
                end: start_date.format('HH-mm')
            }

            if (start_date.isBefore(scope.view.calendar.start)){ // starts on a previous date
                result.start = '07-00'
            }

            if (end_date.isBefore(scope.view.calendar.end)){ // end on a future date
                result.end = '10-59'
            }

            return result

        }

    }

</script>
